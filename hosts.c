#if 0
	shc Version 3.8.7, Generic Script Compiler
	Copyright (c) 1994-2009 Francisco Rosales <frosal@fi.upm.es>

	shc -rvf hosts.sh 
#endif

static  char data [] = 
#define      msg1_z	42
#define      msg1	((&data[1]))
	"\056\146\273\217\021\001\241\006\232\137\204\027\306\074\370\332"
	"\334\263\303\153\257\126\213\222\041\320\074\110\341\040\000\336"
	"\230\362\171\002\125\152\322\043\077\060\261\336\004\137\333\320"
	"\224"
#define      tst1_z	22
#define      tst1	((&data[52]))
	"\145\041\312\323\310\042\156\114\373\371\262\027\357\266\375\134"
	"\332\162\203\055\122\306\155\236\153\061\177\372\124\371"
#define      chk1_z	22
#define      chk1	((&data[81]))
	"\252\003\273\342\206\335\137\327\077\113\074\365\043\041\002\035"
	"\204\243\064\312\334\150\231\303\324\215\141\175"
#define      text_z	1506
#define      text	((&data[294]))
	"\147\256\210\153\015\143\074\241\334\332\233\101\373\146\163\173"
	"\140\310\164\364\060\111\236\064\035\053\226\232\000\025\104\147"
	"\304\314\323\321\057\017\163\014\352\017\116\345\165\301\141\326"
	"\212\326\312\273\037\151\360\075\225\206\327\225\234\034\375\140"
	"\350\320\062\030\340\246\044\312\265\163\260\052\065\021\001\277"
	"\350\313\172\007\064\152\105\311\361\035\137\215\071\134\356\042"
	"\055\040\072\016\307\137\330\175\322\211\250\007\233\251\307\203"
	"\164\101\213\251\254\320\163\235\355\323\052\046\057\031\111\135"
	"\071\203\153\001\343\104\176\266\315\046\275\151\320\204\355\105"
	"\306\170\356\162\111\142\020\066\065\073\135\145\124\246\302\216"
	"\052\056\217\016\162\016\304\100\065\202\252\005\007\227\112\315"
	"\017\071\100\130\233\121\217\321\214\355\066\233\060\150\346\224"
	"\314\226\012\247\377\325\323\014\225\053\357\025\306\137\301\377"
	"\166\315\062\370\372\012\012\110\222\023\000\165\266\167\031\013"
	"\227\032\357\111\314\227\224\152\024\204\373\362\374\057\154\112"
	"\024\373\307\246\315\041\301\122\057\341\233\315\043\112\325\136"
	"\217\345\027\227\236\344\123\133\051\035\117\273\145\070\136\127"
	"\067\020\162\065\077\276\031\365\001\366\310\321\032\215\230\243"
	"\076\050\344\275\013\125\217\122\011\046\233\111\214\142\264\321"
	"\026\166\131\150\311\166\236\245\310\105\374\257\205\101\113\020"
	"\176\135\267\317\061\336\347\033\204\160\353\350\252\213\317\247"
	"\012\356\102\123\065\373\347\163\007\145\175\172\130\302\265\373"
	"\107\307\305\021\155\261\236\152\171\030\357\314\141\140\021\101"
	"\317\152\103\215\170\073\311\155\346\201\132\351\116\224\036\215"
	"\315\214\270\253\375\266\136\140\233\017\105\001\350\244\157\342"
	"\154\052\176\324\231\002\050\133\024\164\053\334\057\166\037\347"
	"\314\046\207\101\054\025\277\073\170\322\213\072\201\350\321\244"
	"\331\130\275\047\026\106\237\014\242\076\264\103\141\174\032\345"
	"\351\134\261\240\217\266\170\230\333\132\166\267\147\216\046\026"
	"\315\150\213\364\153\213\276\110\173\163\355\170\003\136\221\110"
	"\334\276\314\201\376\373\204\364\050\141\325\276\237\111\206\027"
	"\146\070\062\021\121\246\153\141\143\124\036\375\032\312\106\155"
	"\116\022\366\206\033\004\112\237\224\166\113\252\371\137\200\171"
	"\034\002\037\061\246\015\367\246\260\153\147\256\030\030\310\002"
	"\156\056\157\317\056\327\104\223\307\166\256\152\061\072\350\362"
	"\363\237\266\147\376\155\042\306\241\121\305\034\125\263\264\175"
	"\001\233\265\127\376\027\363\036\316\014\212\066\314\342\142\230"
	"\223\137\257\013\146\066\334\236\070\154\127\154\141\136\227\070"
	"\345\107\362\255\313\157\053\110\222\335\215\252\355\272\247\337"
	"\053\211\040\212\201\034\120\102\174\152\374\144\046\241\223\267"
	"\116\344\341\132\305\155\236\037\311\021\317\104\252\373\323\311"
	"\237\017\046\255\253\202\027\331\357\175\120\267\004\340\043\176"
	"\275\071\116\030\257\337\242\105\241\012\135\063\115\321\005\276"
	"\107\364\275\135\040\146\064\344\113\056\137\027\355\210\021\174"
	"\137\132\007\317\321\165\056\310\232\314\114\170\345\152\171\176"
	"\244\007\134\316\005\340\024\135\003\075\136\110\146\156\036\031"
	"\034\150\233\315\065\225\205\007\123\010\370\021\126\221\305\165"
	"\151\111\145\346\236\154\012\310\234\166\326\101\304\201\044\127"
	"\240\176\213\024\112\055\113\353\360\227\247\164\240\050\127\325"
	"\042\277\204\261\272\251\103\227\122\146\150\026\373\301\140\256"
	"\165\341\147\110\240\006\366\173\073\065\357\027\204\315\244\205"
	"\232\114\252\206\022\126\067\121\325\016\155\300\167\054\037\242"
	"\131\332\147\250\377\324\377\350\353\363\047\305\054\346\303\222"
	"\025\261\111\007\202\362\270\130\263\154\110\303\264\245\075\260"
	"\162\165\071\137\064\022\063\044\006\220\151\226\263\174\207\306"
	"\263\161\104\177\317\366\210\270\326\316\074\267\212\264\204\020"
	"\135\045\070\052\046\041\331\035\174\352\372\141\114\312\206\257"
	"\331\306\373\374\272\124\125\113\340\036\201\115\312\264\245\113"
	"\062\202\063\020\234\245\040\326\134\263\106\331\234\325\050\366"
	"\116\333\142\051\027\026\325\123\013\211\044\064\157\277\356\057"
	"\065\023\033\207\177\337\037\145\123\201\257\111\233\333\307\110"
	"\377\047\060\220\036\072\243\051\232\247\313\270\374\167\032\242"
	"\107\143\072\275\323\154\165\070\355\270\206\055\226\242\143\111"
	"\106\267\267\057\101\074\062\054\352\303\257\247\246\133\337\105"
	"\357\065\141\351\031\330\374\276\253\215\361\113\056\165\077\175"
	"\024\017\037\005\370\030\150\113\177\050\034\072\247\125\320\306"
	"\346\066\224\335\331\027\375\135\364\222\165\100\302\040\330\337"
	"\204\260\067\112\103\074\362\226\274\274\227\361\053\344\231\173"
	"\067\043\206\064\363\145\173\363\074\010\116\306\067\043\243\013"
	"\247\321\043\226\067\125\366\365\024\122\012\276\246\120\321\253"
	"\112\011\274\220\156\210\174\047\150\373\140\066\025\041\216\144"
	"\057\271\371\007\030\343\000\214\002\153\000\045\027\266\250\001"
	"\072\263\033\225\272\166\137\173\341\213\212\363\037\120\336\346"
	"\373\147\052\167\037\000\232\176\006\047\114\226\246\047\172\355"
	"\017\024\003\247\227\336\160\053\216\066\144\015\313\250\056\165"
	"\110\306\150\300\372\263\341\160\366\372\100\165\356\241\070\352"
	"\324\315\250\307\226\067\253\076\153\061\061\313\053\365\271\253"
	"\255\206\210\165\146\050\344\171\203\042\272\234\364\044\073\253"
	"\022\144\331\264\061\303\172\056\046\355\320\030\226\105\340\353"
	"\374\303\054\056\234\074\273\322\065\342\140\165\245\277\060\245"
	"\230\362\357\215\251\202\370\336\132\125\136\357\343\003\143\162"
	"\055\317\020\113\117\055\014\366\060\136\270\244\045\206\335\200"
	"\006\141\043\362\107\012\272\374\146\355\276\370\173\005\051\233"
	"\366\053\336\167\033\225\347\033\070\266\025\377\057\153\064\317"
	"\237\324\136\266\001\210\255\226\244\057\145\032\276\044\235\205"
	"\344\016\242\365\331\327\172\273\016\115\067\126\155\256\117\070"
	"\206\117\020\370\123\377\172\212\231\363\027\327\134\333\364\233"
	"\066\330\347\006\176\160\262\132\233\266\326\076\261\220\253\241"
	"\221\115\263\237\037\131\346\052\153\002\014\232\266\037\211\324"
	"\126\167\107\354\122\246\237\046\250\240\306\006\243\373\145\256"
	"\140\004\210\143\050\365\141\122\262\246\262\073\246\175\045\230"
	"\116\007\201\271\027\355\302\221\244\331\362\157\102\167\002\303"
	"\012\367\265\116\067\176\264\140\362\372\037\322\201\052\001\307"
	"\176\077\260\006\226\334\022\244\077\236\173\176\214\374\000\025"
	"\136\011\203\263\220\272\043\112\352\114\146\317\124\125\035\116"
	"\224\172\043\047\106\273\272\374\312\276\052\353\135\255\112\131"
	"\043\260\272\303\374\005\010\201\102\211\224\167\112\146\232\227"
	"\323\155\215\326\057\161\304\037\315\317\253\367\242\003\013\012"
	"\350\120\117\075\157\263\257\226\322\252\062\203\235\131\044\204"
	"\366\346\241\033\304\362\323\122\151\006\210\215\021\062\017\116"
	"\355\321\221\060\171\113\241\026\171\370\132\154\141\127\344\005"
	"\232\117\153\013\054\327\267\115\252\133\314\327\333\324\345\336"
	"\127\302\372\220\275\051\032\310\356\365\056\311\367\156\201\361"
	"\111\261\055\142\201\146\262\322\235\220\035\371\064\003\221\136"
	"\332\201\250\077\202\145\235\371\215\063\053\046\107\113\050\306"
	"\111\072\227\270\130\324\025\200\103\167\334\040\155\340\223\371"
	"\156\276\050\376\314\232\015\221\333\102\023\205\110\032\034\223"
	"\350\054\314\051\204\150\172\024\072\006\001\161\347\225\152\126"
	"\124\222\125\041\055\142\262\011\244\306\216\355\340\253\200\311"
	"\327\115\363\134\266\155\160\360\164\162\141\134\007\314\262\133"
	"\136\007\174\214\151\057\225\016\365\044\373\326\317\174\240\246"
	"\311\223\003\177\000\164\160\165\346\321\321\356\235\203\112\374"
	"\213\306\210\364\366\036\003\353\102\377\301\021\173\141\270\105"
	"\365\273\305\365\057\065\153\026\007\074\004\244\300\116\241\113"
	"\025\051\100\013\107\104\366\211\103\270\233\277\032\123\005\017"
	"\017\312\005\077\000\161\125\010\256\131\255\156\250\116\272\275"
	"\170\373\310\277\077\277\111\203\170\345\102\223\071\107\243\110"
	"\022\251\207\023\032\334\034\311\066\311\067\336\027\362\233\217"
	"\356\144\117\055\044\231\261\235\176\364\061\267\074\324\000\116"
	"\176\207\142\231\144\176\142\232\107\231\171\137\214\025\356\172"
	"\172\076\250\237\327\132\074\126\116\155\016\212\102\016\331\300"
	"\225\073\131\372\272\273"
#define      msg2_z	19
#define      msg2	((&data[2049]))
	"\243\030\242\056\232\111\172\234\167\165\225\215\221\243\115\111"
	"\121\014\004\016"
#define      xecc_z	15
#define      xecc	((&data[2072]))
	"\120\135\236\050\350\134\130\012\163\215\050\374\013\173\367\070"
	"\041\337"
#define      rlax_z	1
#define      rlax	((&data[2087]))
	"\130"
#define      lsto_z	1
#define      lsto	((&data[2088]))
	"\067"
#define      opts_z	3
#define      opts	((&data[2089]))
	"\200\367\210"
#define      tst2_z	19
#define      tst2	((&data[2093]))
	"\331\234\336\204\360\034\211\236\213\210\073\313\061\040\344\036"
	"\143\130\026\250"
#define      date_z	1
#define      date	((&data[2112]))
	"\002"
#define      inlo_z	3
#define      inlo	((&data[2113]))
	"\317\112\337"
#define      pswd_z	256
#define      pswd	((&data[2180]))
	"\013\125\015\155\067\061\275\225\317\115\233\014\263\373\206\161"
	"\251\156\074\342\227\026\363\202\205\101\306\357\112\306\357\125"
	"\033\374\302\123\056\200\350\376\315\204\013\201\177\222\362\050"
	"\000\056\012\230\105\376\032\313\100\341\273\212\247\252\340\303"
	"\356\116\136\216\314\242\007\130\144\272\052\357\026\273\065\314"
	"\022\245\363\102\272\277\151\037\317\301\063\030\054\247\375\033"
	"\366\134\251\303\376\261\034\142\154\106\122\202\002\207\117\025"
	"\055\102\127\350\002\300\007\321\201\073\352\256\343\347\312\331"
	"\103\163\235\102\045\271\245\221\000\367\023\002\176\143\027\254"
	"\246\157\224\250\057\234\172\261\330\144\137\274\114\051\225\220"
	"\235\062\322\302\354\167\124\354\156\150\356\355\313\006\232\161"
	"\166\057\031\245\313\224\126\244\370\266\140\105\340\366\325\176"
	"\051\250\101\025\037\225\001\216\375\360\174\311\367\026\072\155"
	"\105\124\023\021\350\152\266\341\040\026\046\001\015\373\177\066"
	"\243\300\114\303\125\115\122\123\076\316\034\066\345\127\244\052"
	"\253\267\074\223\042\362\164\102\011\233\104\026\226\303\115\072"
	"\204\231\376\332\346\120\056\045\037\112\133\004\241\377\057\115"
	"\267\154\341\331\136\125\034\150\361\140\176\207\044\313\302\251"
	"\144\300\203\113\020\261\161\060\374\314\065\236\314\145\353\204"
	"\321\314\135\060\042\172\230\023\332\027\233\377\342\135\250\107"
	"\247\242\027\325\042\000\324\360\204\337\161\003\161\143\054\161"
	"\222\067\012\330\066\044\243\166\005\136\001\255\010\341\160\257"
	"\204\210\205\246\210\131\226\015\071\010\021\252\154\075\034\377"
	"\164\046\327\253\113\172\042\121\330\043\377\341\005\160\221\211"
#define      chk2_z	19
#define      chk2	((&data[2500]))
	"\335\035\106\217\144\313\006\017\256\172\136\156\073\066\322\254"
	"\264\206\310"
#define      shll_z	8
#define      shll	((&data[2520]))
	"\216\034\331\047\347\071\071\376\144\251\317"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !defined(TRACEABLE)

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !defined(TRACEABLE) */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		if (text_z < hide_z) {
			/* Prepend spaces til a hide_z script size. */
			scrpt = malloc(hide_z);
			if (!scrpt)
				return 0;
			memset(scrpt, (int) ' ', hide_z);
			memcpy(&scrpt[hide_z - text_z], text, text_z);
		} else {
			scrpt = text;	/* Script text */
		}
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, argv[0]);
		} else {
			scrpt = argv[0];
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !defined(TRACEABLE)
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
